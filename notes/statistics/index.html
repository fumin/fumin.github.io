<html>
  <head>
    <meta charset="utf-8"/>
    <script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  </head>
  <style>
body {
  font-size: xx-large;
}
table {
  font-size: xx-large;
}
  </style>
  <body>
    <div id="container" style="margin-left:auto; margin-right:auto;">
<h1>Statistics</h1>

<h2>Mean \(E(X)\) may not capture a problem's concern</h2>
<p>
<q>
Flip a fair coin 100 times—it gives a sequence of heads (H) and tails (T). For each HH in the sequence of flips, Alice gets a point; for each HT, Bob does, so e.g. for the sequence THHHT Alice gets 2 points and Bob gets 1 point. Who is most likely to win?
</q>
-- <a href="https://twitter.com/littmath/status/1769044719034647001">Daniel Litt</a></p>
<p>Answer: Bob wins</p>
<p>An intuitive explanation is that HH's distribution is more skewed due to the fact that HH's possible scores are much higher due to consecutive heads. Thus, HH's distribution has more probability mass in the region <code>x &lt; mean</code>. Since HH and HT have the same mean, it follows that <code>HH &lt; HT</code> happens more frequently.</p>
<p>Let <code>n</code> be the sequence length, the mean of Alice's and Bob's distributions are the same <code>(n-1)/4</code>. The below diagram shows the distributions of <code>HH</code> and <code>HT</code> and <code>HH - HT</code>:</p>
<div style="text-align: center;"><img src="n16.png"></div>
<div style="text-align: center;"><img src="n16diff.png"></div>
<p>As we increase n, the number of possible sequences increases exponentially. Thus we experiment with the sampling method, too. As shown in the below diagrams for <code>n = 32</code>, the sampling method matches pretty well with the exact one:</p>
<div style="text-align: center;"><img src="n32.png"></div>
<div style="text-align: center;"><img src="n32diff.png"></div>
<p>Having confirmed that sampling works, we plot the case for <code>n = 1024</code></p>
<div style="text-align: center;"><img src="n1024.png"></div>
<p>It seems that the Central Limit Theorem is in effect here. Moreover the edge HT over HH has diminishes as the sequence length increases:</p>
<table style="margin-left: auto; margin-right: auto; border-spacing: 1em 0;">
  <thead><tr>
    <td></td>
    <td>16</td>
    <td>32</td>
    <td>1024</td>
  </tr></thead>
  <tbody>
    <tr><td><code>hh &lt; ht</code></td><td>0.464</td><td>0.475</td><td>0.495</td></tr>
    <tr><td><code>hh == ht</code></td><td>0.143</td><td>0.100</td><td>0.018</td></tr>
    <tr><td><code>hh &gt; ht</code></td><td>0.393</td><td>0.425</td><td>0.487</td></tr>
  </tbody>
</table>

<h2>Mean Deviation is more useful than Standard Deviation</h2>
<p>The classical argument regarding the Standard Deviation \(\sqrt{\frac{1}{n-1}\sum(x-\overline{x})^{2}}\) having an advantage over the Mean Absolute Deviation \(\frac{1}{n}\sum\left| x - \overline{x} \right|\) is a fragile one.
It works only for the perfect Normal distribution and collapses at the slightest occurance of fat tails.
In mathematical terms, the argument states that the statistical efficiency \(\frac{Var(X)}{E(X)^{2}}\) of the Standard Deviation is better than that of the Mean Deviation:</p>
$$\displaylines{
\begin{aligned}
\text{Asymptotic Relative Efficiency (ARE)} =\space & \underset{n\to \infty }{lim}\left( \frac{\frac{Var(Std)}{E(Std)^{2}}}{\frac{Var(Mad)}{E(Mad)^{2}}} \right) \\
=\space & \underset{n\to \infty }{lim}\frac{\frac{n{\Gamma(\frac{n}{2})}^{2}}{2{\Gamma(\frac{n+1}{2})}^{2}}-1}{\frac{\pi-2}{2n}} \\
=\space & \frac{1}{\pi-2} \simeq 0.875
\end{aligned}
}$$
<p>However, this result quickly becomes invalidated when considering the simplest model for volatility, which is a mixing model with an occasional jump with probability \(p\):</p>
$$\displaylines{
Var(x)=\begin{cases}
\sigma^{2}(1+a) & \text{with probability $p$} \\
\sigma^{2} & \text{with probability $p-1$}
\end{cases}
}$$
<p>The below diagram shows simulation results with \(p=0.01\) and \(n=10000\):</p>
<div style="text-align: center;"><img src="are.png"></div>
<p>We see that even though for \(a=0\) \(RE=0.878\), for \(a=2\) \(RE=1.434\) which starts to cause degradation. In other words, a minute presence of outliers makes MAD more efficient than STD.</p>
<p>Morever, many statistical phenomena and processes have "infinite variance" (such as the popular Pareto 80/20 rule) but have finite, and sometimes very well behaved, mean deviations.
Whenever the mean exists, MAD exists. The reverse (infinite MAD and finite STD) is never true.</p>
<p>In summary, we should retire the notion of Standard Deviation and replace it with the more effective one of Mean Deviation.
Standard deviation, STD, should be left to mathematicians, physicists and mathematical statisticians deriving limit theorems.
There is no scientific reason to use it in statistical investigations in the age of the computer.</p>

<h2>The Central Limit Theorem does not apply to many real world problems with finite sample sizes</h2>
<p>The Generalized Central Limit Theorem states that the sum of random variables \(S_{n} = X_{1}+X_{2}+\cdots +X_{n}\) converges to \(n\mu + n^{\frac{1}{\alpha}}\text{Stable}(\alpha)\) where \(\text{Stable}(\alpha)\) is the <a href="https://en.wikipedia.org/wiki/Stable_distribution">Stable distribution</a>, parameterized by the tail index \(\alpha\).
Thus when \(\alpha > 1\), \(\underset{n\to \infty}{lim}\left( \frac{S_{n}}{n} - \mu \right) = n^{\frac{1}{\alpha}-1}  = 0\) and we get the Law of Large Numbers.
The below graph (Fig 8.1<sup id="cite_ref-1a"><a href="#cite_note-1">[1a]</a></sup>) illustrates this phenomenon assuming \(X_{n}\) has been subtracted by the linear trend \(\mu\) leaving the random walk \(S_{n}\):
<div style="text-align: center;"><img src="kappa.png"></img></div>
A consequence of this is that for all powers \(p=1,2,3,\cdots\), if \(E(X^{p}) < \infty\) then (10.2.6<sup id="cite_ref-1b"><a href="#cite_note-1">[1b]</a></sup>)
$$\displaylines{
\underset{n\to \infty}{lim}\frac{\text{max}(X_{1}^{p},X_{2}^{p},\cdots ,X_{n}^{p})}{X_{1}^{p}+X_{2}^{p}+\cdots +X_{n}^{p}} = 0
}$$
For example, in the case of \(p=4\), the existence of the 4th moment should prevent a single data point to dominate the kurtosis's calculation as \(n\) increases.
This behaviour is observed for the Gaussian distribution, but not for both the Taiwan<sup id="foot_ref-1"><a href="#foot_note-1">1</a></sup> and U.S. stock markets, as shown in the below Max-to-Sum plot (MS plot):
<div style="text-align: center;"><img src="ms_taiex.png" style="max-width: 50%;"/><img src="ms_taiex_gauss.png" style="max-width: 50%;"/></div>
<div style="text-align: center;"><img src="ms_sp500.png"/></div>
<table style="margin-left: auto; margin-right: auto; margin-top: 1em; border-spacing: 1em 0;">
  <thead><tr>
    <td></td>
    <td>dataset size</td>
    <td>\(|X|^{4}\) Max-to-Sum</td>
  </tr></thead>
  <tbody>
    <tr><td>Taiwan stock index (TAIEX)</td><td>864 (58 years)</td><td>0.25</td></tr>
    <tr><td>S&amp;P 500</td><td>964 (69 years)</td><td>0.46</td></tr>
    <tr><td>Gaussian with same σ as TAIEX</td><td>864</td><td>0.04</td></tr>
    <tr><td colspan="3" style="text-align: center;">Data below from Table 7.2 Taleb<sup id="cite_ref-1c"><a href="#cite_note-1">[1c]</a></sup></td></tr>
    <tr><td>Silver</td><td>46 years</td><td>0.94</td></tr>
    <tr><td>Crude Oil</td><td>26 years</td><td>0.79</td></tr>
    <tr><td>Yen/USD</td><td>38 years</td><td>0.27</td></tr>
    <tr><td>Jakarta Stock Index</td><td>16 years</td><td>0.19</td></tr>
    <tr><td>Corn</td><td>49 years</td><td>0.18</td></tr>
  </tbody>
</table>
</p>
<p>
The reason for the volality in the kurtosis of both the Taiwan and U.S. stock markets is due to their fat tails.
To quantify how fat the tails are, we fit<sup id="foot_ref-2"><a href="#foot_note-2">2</a></sup> them to the pareto distribution \(\frac{1}{x^{\alpha + 1}}\) where alpha is the tail index<sup id="foot_ref-3"><a href="#foot_note-3">3</a></sup>. 
The smaller \(\alpha\), the fatter the tail; for \(\alpha <= 4\) kertosis does not exist; for \(\alpha <= 3\) skewness does not exist; for \(\alpha <= 2\) variance becomes infinite; for \(\alpha <= 1\) mean becomes infinite.
<div style="text-align: center;"><img src="loglog_taiex.png"></img></div>
<div style="text-align: center;"><img src="loglog_sp500.png"></img></div>
</p>
<p>
We see that the fitted tail indices are smaller than 3, which explains why the 3rd and 4th moments in the MS plots never converge.
With a tail index \(\alpha\) less than 4, the sample variance \(\frac{1}{n}\sum X_{i}^{2}\) converges to \(\frac{1}{n^{1-\frac{2}{\alpha}}}\left(\text{log}(n)\right)^{\frac{2}{\alpha}} \text{Stable}(\frac{\alpha}{2})\) with \(\frac{\alpha}{2} < 2\), instead of the <a href="https://en.wikipedia.org/wiki/Variance#Distribution_of_the_sample_variance">chi-square distribution</a>.
Since \(n^{1-\frac{2}{\alpha}}\) is slower than \(\sqrt{n}\), which is the convergence speed provided by the Central Limit Theorem, the <a href="https://en.wikipedia.org/wiki/F-test_of_equality_of_variances#Properties">chi-square test</a> for variance and the <a href="https://en.wikipedia.org/wiki/F-test#Regression_problems">Goodness of fit test</a> for linear regression give dangerously misleading confidence intervals for the Taiwan and U.S. stock markets<sup id="foot_ref-4"><a href="#foot_note-4">4</a></sup>.
</p>
<p>
A quantitative metric that measures the convergence speed of the Central Limit Theorem is the \(\kappa\) metric introduced by Nassim Taleb (Equation 8.1 <sup id="cite_ref-1d"><a href="#cite_note-1">[1d]</a></sup>).
Let \(\mathbb{M}(n) = \mathbb{E}(\left| S_{n} - \mathbb{E}(S_{n}) \right|)\) be the mean absolute deviation for \(n\) summands, define
$$\displaylines{
\kappa(n_{0}, n) = 2 - \frac{\text{log}(\frac{n}{n_{0}})}{\text{log}(\frac{\text{min}\left\{ \mathbb{M}(i),\space i\ge n \right\} }{\mathbb{M}(n_{0})})}
}$$
By definition, \(\kappa(n_{0}, n) \ge \kappa(n_{0}, n+1)\), and for stable distributions \(\kappa(n_{0}, n) = 2 - \alpha\).
Since the Gaussian distribution corresponds to \(Stable(2)\), \(\kappa_{gaussian} = 0\).
</p>
<p>
Let \(P\) be some distribution, \(n_{g}\) be some sample size, since \(\kappa\) is related to the mean absolute deviation \(\mathbb{M}\), we can use it to calculate the minimum sample size \(n_{\nu}\) such that the deviation of said distribution \(P\) \(\frac{\mathbb{M}_{P}(n_{nu})}{n_{nu}}\) is less than that of a Gaussian \(\frac{\mathbb{M}_{gaussian}(n_{g})}{n_{g}}\).
Let \(n_{0}=1\), and scale \(P\) such that \(\mathbb{M}_{P}(1)=\mathbb{M}_{gaussian}(1)\), then
$$\displaylines{
\begin{aligned}
\frac{\mathbb{M}_{P}(n_{\nu})}{n_{\nu}} < \frac{\mathbb{M}_{gaussian}(n_{g})}{n_{g}} & \Rightarrow \frac{n_{\nu}^{\frac{1}{2-\kappa(n_{\nu})}}}{n_{\nu}} < \frac{n_{g}^{\frac{1}{2}}}{n_{g}} \\
& \Rightarrow n_{\nu} < n_{g}^{\frac{2-\kappa(n_{\nu})}{2(1-\kappa(n_{\nu}))}} \\
\end{aligned}
}$$
Since \(n_{\nu} > n_{g}\), thus \(\kappa(n_{\nu}) < \kappa(n_{g})\). 
Note also for distributions where the mean exists, that is with a tail index larger than 1, \(0 \le \kappa(n_{g}) \le 1\), and thus \(\kappa(n_{g}) < \frac{2\kappa(n_{g})}{\kappa(n_{g})+1}\), and \(\kappa(n_{\nu}) < \frac{2\kappa(n_{g})}{\kappa(n_{g})+1}\). In this case,
$$\displaylines{
\begin{aligned}
\kappa(n_{\nu}) < \frac{2\kappa(n_{g})}{\kappa(n_{g})+1} & \Rightarrow \frac{2-\kappa(n_{\nu})}{2(1-\kappa(n_{\nu}))} < \frac{1}{1-\kappa(n_{g})} \\
& \Rightarrow n_{\nu} < n_{g}^{\frac{1}{1-\kappa(n_{g})}}
\end{aligned}
}$$ 
In other words, given \(n_{g}\), we can use \(n_{\nu} = n_{g}^{\frac{1}{1-\kappa(n_{g})}}\) to gaurantee that \(\frac{\mathbb{M}_{P}(n_{\nu})}{n_{\nu}} < \frac{\mathbb{M}_{gaussian}(n_{g})}{n_{g}}\).
For the pareto distribution, we have the following values for \(\kappa(n)\):
</p>
<p>
<table style="margin-left: auto; margin-right: auto; border-spacing: 1em 0;">
  <caption id="table-1">Table 1: \(\kappa_{\alpha}(n)\) values for the Pareto distribution</caption>
  <thead><tr>
    <td>\(\alpha\)</td>
    <td>2</td>
    <td>30</td>
    <td>100</td>
    <td>1,000</td>
    <td>10,000</td>
    <td>100,000</td>
    <td>1,000,000</td>
    <td>∞</td>
  </tr></thead>
  <tbody>
    <tr><td>1.16</td><td>0.879</td><td>0.863</td><td>0.858</td><td>0.853</td><td>0.850</td><td>0.848</td><td>0.847</td><td>0.840</td></tr>
    <tr><td>1.25</td><td>0.829</td><td>0.799</td><td>0.790</td><td>0.779</td><td>0.772</td><td>0.768</td><td>0.765</td><td>0.75</td></tr>
    <tr><td>1.50</td><td>0.724</td><td>0.660</td><td>0.639</td><td>0.608</td><td>0.587</td><td>0.572</td><td>0.561</td><td>0.50</td></tr>
    <tr><td>1.75</td><td>0.650</td><td>0.560</td><td>0.529</td><td>0.482</td><td>0.447</td><td>0.420</td><td>0.400</td><td>0.25</td></tr>
    <tr><td>2.00</td><td>0.594</td><td>0.487</td><td>0.449</td><td>0.391</td><td>0.348</td><td>0.314</td><td>0.286</td><td>0</td></tr>
    <tr><td>2.25</td><td>0.551</td><td>0.431</td><td>0.389</td><td>0.326</td><td>0.279</td><td>0.242</td><td>0.214</td><td>0</td></tr>
    <tr><td>2.50</td><td>0.517</td><td>0.387</td><td>0.343</td><td>0.278</td><td>0.231</td><td>0.195</td><td>0.169</td><td>0</td></tr>
    <tr><td>2.75</td><td>0.488</td><td>0.353</td><td>0.308</td><td>0.242</td><td>0.197</td><td>0.164</td><td>0.140</td><td>0</td></tr>
    <tr><td>3.00</td><td>0.465</td><td>0.325</td><td>0.280</td><td>0.215</td><td>0.172</td><td>0.142</td><td>0.120</td><td>0</td></tr>
    <tr><td>3.25</td><td>0.445</td><td>0.302</td><td>0.257</td><td>0.194</td><td>0.153</td><td>0.125</td><td>0.106</td><td>0</td></tr>
    <tr><td>3.50</td><td>0.428</td><td>0.283</td><td>0.238</td><td>0.178</td><td>0.139</td><td>0.113</td><td>0.095</td><td>0</td></tr>
    <tr><td>3.75</td><td>0.413</td><td>0.267</td><td>0.223</td><td>0.164</td><td>0.128</td><td>0.104</td><td>0.087</td><td>0</td></tr>
    <tr><td>4.00</td><td>0.400</td><td>0.253</td><td>0.210</td><td>0.153</td><td>0.118</td><td>0.096</td><td>0.081</td><td>0</td></tr>
  </tbody>
</table>
</p>
<p>
For the Taiwan stock index, we have \(n_{\nu}=15555\) daily samples, sample mean \(\overline{x}=0.00015\), sample standard deviation \(s=0.00624\).
Setting the null hypothesis to \(\mu=0\), the naive t-statistic is \(\frac{\overline{x}-\mu}{\frac{s}{\sqrt{n_{\nu}}}}=3.01\), which is above the 5% critical value of 1.96.
However, since the Taiwan stock index has a tail index of \(\alpha=2.51\), the true gaussian degrees of freedom with a deviation that is equal to \(\text{Pareto}(2.51)\) is actually \(n_{g}=n_{\nu}^{\frac{2-2\kappa_{\alpha}(n_{\nu})}{2-\kappa_{\alpha}(n_{\nu})}}\).
From <a href="#table-1">Table 1</a>, we see that \(\kappa_{2.51}(15555)\simeq 0.231\).
This means the true equivalent gaussian sample size is \(n_{g}=15555^{\frac{2-2*0.231}{2-0.231}}=4411\), and the true t-statistic is 1.60, which is not significant.
Therefore, when using the Central Limit Theorem correctly, even with 58 years of data, it remains inconclusive whether the Taiwan stock market has a non-zero return.
</p>
<p>
For the common 80/20 law which is \(\text{Pareto}(\text{log}_{4}(5))=\text{Pareto}(1.16)\), to get mean deviations equivalent to a 30 sample gaussian, the Central Limit Theorem would require a sample size of \(30^{\frac{1}{1-\kappa_{\text{Pareto}(1.16)}(30)}}=30^{\frac{1}{1-0.863}}=6\cdot 10^{10}\).
</p>

<h2>Physics might dictate that the mean \(E(X)\) be non-existent</h2>
<p>Consider the intensity of a point light source on a vertical wall, as shown below:</p>
<div style="text-align: center;"><img src="light.svg"></img></div>
<p>The probability of \(\theta\) is the uniform distribution, and the distance between the light source and the wall is \(\ell\). We are interested in the distribution of \(x\). Since \(tan(\theta)=\frac{x}{\ell}\), the distribution is:</p>
$$\displaylines{
\begin{aligned}
P(X) =\space & 1 \cdot d\theta \\
=\space & \frac{d\theta}{dx}dx \\
=\space & \frac{1}{\pi} \frac{\ell}{\ell^{2}+x^{2}}dx
\end{aligned}
}$$
<p>which is the Cauchy distribution \(Cauchy(\ell)\). The Cauchy distribution has the property that the sum of two Cauchies is also a Cauchy, \(Cauchy(\ell_{1}) + Cauchy(\ell_{2}) = Cauchy(\ell_{1}+\ell_{2})\). This means we can view the distribution as a random walk by photons in small steps, known as the Huygens principle:</p>
<div style="text-align: center;"><img src="walk.svg"></div>
<p>We split \(\ell\) into \(n\) steps, and let \(X_{t}\) be the random variable describing a photon's random walk, \(P(X_{t}) = Cauchy(\frac{\ell}{n})\).
The law of large numbers says that the final location of the photon, \(X_{1} + X_{2} + ... + X_{n}\) approaches \(n\cdot E(X)\) as \(n\) increases.
In other words, we would observe a single spot of bright light at position \(n\cdot E(Cauchy(\frac{\ell}{n}))\), when the rest of the wall is completely dark.
However, a completely dark wall is completely nonsensical in physics.
The only way out of this paradox is to conclude that the mean of the Cauchy distribution does not exist.</p>

<h2>Power laws are more common than the gaussian in the sample size limit \(n\to \infty\)</h2>
<p>
Many fields are interested in quantities outside of the sum of random variables \(X_{1}+X{2}+\cdots +X{n}\).
For example, hydrology is focused on the maxima of random variables \(\text{max}\left( X_{1}, X{2}, \cdots , X{n} \right)\) where \(X_{i}\) represents the flood level.
The insurance industry is concerned with the mean excess function \(E\left( X-u | X>u \right)\) which can be interpreted as the expected claim size.
The mean excess function is also called mean residual life in a reliability or medical context.
For these quantities, We have the following limit laws:
<ul>
  <li>
    Generalized Central Limit Theorem:
    $$\displaylines{
    X_{1}+X_{2}+\cdots +X_{n} \underset{n\to\infty}{=} Stable(\alpha) \underset{x\to\infty}{\sim} \begin{cases}
    \frac{1}{x^{1+\alpha}} & ,\space X \sim \frac{1}{x^{1+\alpha}},\space 0 < \alpha < 2 \\
    Gaussian & ,\space others \\
    \end{cases}
    }$$
  </li>
  <li>
    Fisher–Tippett–Gnedenko Theorem (Definition 3.4.1, Embrechts<sup id="cite_ref-2a"><a href="#cite_note-2">[2a]</a></sup>):
    $$\displaylines{
    \text{max}\left( X_{1}, X_{2}, \cdots , X_{n} \right) \underset{n\to\infty}{=} GEV \underset{x\to\infty}{\sim} \begin{cases}
    \frac{1}{x^{1+\alpha}} & ,\space X \sim \frac{1}{x^{1+\alpha}},\space \alpha< \infty \\
    e^{-x} & ,\space \alpha = \infty \\
    \end{cases}
    }$$
    <p>
    where GEV is the Generalized Extreme Value distribution.
    </p>
  </li>
  <li>
    Pickands–Balkema–De Haan Theorem:
    $$\displaylines{
    P\left( X>u+x | X>u \right) \underset{u\to\infty}{=} GPD \space \begin{cases}
    \frac{1}{x^{1+\alpha}} & ,\space X \sim \frac{1}{x^{1+\alpha}},\space \alpha< \infty \\
    e^{-x} & ,\space \alpha = \infty \\
    \end{cases}
    }$$
    where GPD is the Generalized Pareto Distribution.
    Note that the GPD is different from the GEV, though their behaviour are the same as \(x \to \infty\).
  </li>
</ul>
The fat tails of the Pareto distribution have the following properties:
<ul>
  <li>
    \(\underset{u\to \infty}{lim}P\left( x>u+t | x>u \right)=1\) for all \(t>0\)<sup id="foot_ref-5"><a href="#foot_note-5">5</a></sup>, in other words if we observed some high level quantity in the past, the probability that we observe any higher level is 1.
  </li>
  <li>
    \(P\left( X_{1}+X_{2}+\cdots X_{n} > x\right)=P\left( \text{max}\left( X_{1}, X_{2}, \cdots , X_{n} \right) > x \right)\)<sup id="foot_ref-6"><a href="#foot_note-6">6</a></sup>, thus if we see a sum of events exceeding some high level, it is always due to one particular catastrophy.
  </li>
  <li>
    \(E\left( X-u|X>u \right)=\frac{1}{\alpha}\cdot u\), where \(\alpha\) is the tail index<sup id="foot_ref-7"><a href="#foot_note-7">7</a></sup>.
    This means it is impossible to hedge against a disaster by an insurance policy that pays only a predetermined fixed amount, since the shortfall is always larger than 0.
  </li>
</ul>
We borrow Taleb's words to summarize this section:
<ul>
  <li>
    Robust statistics is not robust.
    <a href="https://en.wikipedia.org/wiki/Robust_statistics">Robust statistics</a> shoots for methods that don't change in response of a tail event, such as the trimmed mean or winsorization.
    We now know that the one of two outlier events such as the 1987 U.S. stock market crash hold the key to truly understanding our data.
  </li>
  <li>
    The empirical distribution is not empirical.
    One aspect of this concept is that future maxima are poorly tracked by past data without some intelligent extrapolation.
    Another aspect is the conflation between the true expected payoff above some threshold \(K\), with the naive multiplication of the impact at \(K\) and the probability of exceeding \(K\)<sup id="cite_ref-1e"><a href="#cite_note-1">[1e]</a></sup>.
    In mathematical terms, let \(f\) be a probability density function, and \(g\) be an impact function. The true expected payoff above \(K\), \(I_{1}\) is:
    $$\displaylines{
    I_{1} = \int_{K}^{\infty}g(x)f(x)dx
    }$$
    The misleading payoff \(I_{2}\) is:
    $$\displaylines{
    I_{2} = g(K)\int_{K}^{\infty}f(x)dx
    }$$
    For \(g\) that is monotically increasing, \(I_{1}=I_{2}\) only under thin tails, not fat tails.
    One example of this confusion is Bill Gates' complaint about the media spending over 30% of their coverage on terrorism, which actually causes only 0.01% of deaths statistically (section 3.6 Taleb<sup id="cite_ref-1f"><a href="#cite_note-1">[1f]</a></sup>).
    <div style="text-align: center;"><img src="causesofdeath.jpeg"></div>
    In this case the payoff is simply \(g(x)=x\), and according to Taleb the tail index of wars is \(\alpha=0.53\).
    Since the mean of \(\frac{1}{x^{1+0.53}}\) is \(\infty\), the difference between \(I_{1}\) and \(I_{2}\) is infinity.
  </li>
  <li>
    Statistics is never standard.
    The convergence speed of the Central Limit Theorem is often ignored in statistical discussions.
    Unfortunately, such ignorance leads to significant gaps between the true and calculated values for important quantities such as the Value at risk (VaR) of a portfolio, or the Gini coefficient for economic inequality.
    In general, the scientific way to handle fat-tailed data is to first estimate its tail index, then do inference based on the resulting Pareto model.
  </li>
</ul>
</p>

<hr>
<ol>
  <li id="foot_note-1">
    <b><a href="#foot_ref-1">^</a></b>
    We use 18 day returns for the Taiwan stock market, as opposed to the 1 day in Chapter 10 of Taleb<sup id="cite_ref-1g"><a href="#cite_note-1">[1g]</a></sup>.
    The reason is because Taiwan's 1 day return distribution is not a Pareto, due to the market regulation of capping daily stock price fluctuations at 7%.
  </li>
  <li id="foot_note-2">
    <p>
    <b><a href="#foot_ref-2">^</a></b>
    Before fitting our data, it is important to check that our sample is indeed independent and identically distributed (i.i.d.).
    </p>
    <p>
    Define a new record as a data point whose value is higher than all values before it.
    For i.i.d. data, the number of new records at time \(t\) grows roughly as \(log(t)\) (Section 10.2.7, Taleb<sup id="cite_ref-1h"><a href="#cite_note-1">[1h]</a></sup>).
    Below, we see that this is indeed the case for both the Taiwan and U.S. stock markets:
    <div style="text-align: center;"><img src="record.png"></div>
    Furthermore, since the number of new records is sensitive to the ordering of data, it serves as a good test for dependence between successive events in a time series.
    For i.i.d. data, we should expect the number of new records be invariant to random permutations of the underlying data.
    The below graphs show that our empirical number of records of 6 do not lie at the edges of the the distribution among 1000 permutations, suggesting an acceptance of the i.i.d. hypothesis:
    <div style="text-align: center;"><img src="record_perm.png"></div>
    </p>
    <p>
    On the time domain side, for i.i.d. data, events exceeding a high threshold form a <a href="https://en.wikipedia.org/wiki/Poisson_point_process">Poisson process</a>.
    Therefore, the inter-arrival times of these high values follow the exponential distribution (Example 6.5.9, Embrechts<sup id="cite_ref-2b"><a href="#cite_note-2">[2b]</a></sup>).
    The left plot below shows that this is indeed the case for the Taiwan stock market.
    The right plot below further confirms that these inter-arrival times are mutually independent.
    <div style="text-align: center; position: relative; left: -10vw; width: 90vw;"><img src="interarrival_qq_taiex.png" style="max-width: 50%;"/><img src="interarrival_acf_taiex.png" style="max-width: 50%;"/></div>
    For the U.S. stock market, the below plots show that the independent Poisson process assumption also holds:
    <div style="text-align: center; position: relative; left: -10vw; width: 90vw;"><img src="interarrival_qq_sp500.png" style="max-width: 50%;"/><img src="interarrival_acf_sp500.png" style="max-width: 50%;"/></div>
    </p>
    <p>
    Last but not least, we stress that the i.i.d. evidence here only apply to the <em>extreme values</em> of our data.
    It is well known that the stock market carry strong correlations day-to-day, although this effect might be weakened to some degree by our use of 18 day returns.
    </p>
  </li>
  <li id="foot_note-3">
    <b><a href="#foot_ref-3">^</a></b>
    The Zipf plot shows a necessary but not sufficient condition for fat tails.
    Therefore, we complement the analysis with a mean excess function plot (ME plot)<sup id="cite_ref-3"><a href="#cite_note-3">[3]</a></sup>.
    The mean excess function is defined as \(e(u) = E(X-u|X>u)\), which captures the idea of \(X\)'s expected excess beyond some threshold \(u\), given that \(X > u\).
    It is most useful for identifying the subexponential family of distributions, since they are the only class of distributions where \(\underset{u\to \infty}{lim}e(u) = \infty\) (Equation 6.5<sup id="cite_ref-2c"><a href="#cite_note-2">[2c]</a></sup>).
    Below we show \(e(u)\) for some classical distributions:
    <div style="text-align: center;"><img src="me.png"></div>
    Below we show the ME plots for both the Taiwan and U.S. stock markets:
    <div style="text-align: center;"><img src="me_taiex.png"></div>
    <div style="text-align: center;"><img src="me_sp500.png"></div>
    Since there is undoubtedly an upward trend, it is clear that both data belong to the subexponential class and have fat tails.
  </li>
  <li id="foot_note-4">
    <p>
    <b><a href="#foot_ref-4">^</a></b>
    Here we numerically show how far off the Central Limit Theorem estimates are for the variance of Taiwan's stock market TAIEX.
    The sample size of TAIEX is 864, and is sampled from the \(\text{Pareto}(2.51)\) distribution.
    If we blindly conduct the standard chi-square test for variance at upper significance level of 5%, we get an upper confidence limit of \(\text{inverse-CDF}\left( \frac{\chi^{2}(864-1)}{864-1}, 0.05 \right) =\) <code>scipy.stats.chi2.ppf(1-0.05, 863)/863 = 1.0805</code>.
    Henceforth, we might erroneously believe that 95% percent of the time, our sample estimate would deviate from the true variance by only 8%, implying that our sample size of 864 is sufficient.
    This can also be seen in the below Monte Carlo results for Gaussians:
    </p>
    <div style="text-align: center; position: relative; left: -10vw; width: 90vw;"><img src="var_gaussian.png" style="max-width: 50%;"/><img src="var_gaussian_loglog.png" style="max-width: 50%;"/></div>
    <p>
    However, in reality under the true distribution \(\text{Pareto}(2.51)\), the distribution is drastically different as shown below:
    </p>
    <div style="text-align: center; position: relative; left: -10vw; width: 90vw;"><img src="var_pareto.png" style="max-width: 50%;"/><img src="var_pareto_loglog.png" style="max-width: 50%;"/></div>
    <p>
    We see that the <a href="https://en.wikipedia.org/wiki/Mode_(statistics)">mode</a> is around 0.5, and the 95% percentile is at 1.9.
    This means we are likely to underestimate the true variance by half, and our confidence interval is at best 190%.
    Moreover, we observe that the these issues are due to the power law fat tail that is not attenuated even at a sample size of 915.
    The below graph shows that even with a million samples, our confidence interval of 1.2 remains much larger than that of the standard chi-square test:
    </p>
    <div style="text-align: center; position: relative; left: -10vw; width: 90vw;"><img src="var_pareto_1000000.png" style="max-width: 50%;"/><img src="var_pareto_1000000_loglog.png" style="max-width: 50%;"/></div>
    <p>
    To conclude, tests involving the square of a random variable \(X^{2}\) in the numerator are dangerous to perform on distributions that lack the 4th moment, which include the majority of real world data.
    This means standard statistical concepts such as covariance \(\sum_{i}(x_{i}-\overline{x_{i}})(y_{i}-\overline{y_{i}})\), as well as the \(R^{2}\) coefficient for linear regression \(R^{2}=1-\frac{\sum_{i}\left( y_{i}-(ax_{i}+b) \right)^{2}}{\sum_{i}\left(y_{i}-\overline{y_{i}}\right)^{2}}\) are much less useful than advertised.
    </p>
  </li>
  <li id="foot_note-5">
    <b><a href="#foot_ref-5">^</a></b>
    We note that from Equation 3.45, Embrechts<sup id="cite_ref-2d"><a href="#cite_note-2">[2d]</a></sup>:
    $$\displaylines{
    P\left( x>u+t | x>u \right)=\begin{cases}
    \left( 1 + \frac{1}{\alpha}\cdot \frac{t}{e(u)} \right)^{-\alpha} & ,\space \alpha<\infty \\
    e^{-\frac{t}{e(u)}} & ,\space \alpha=\infty
    \end{cases}
    }$$
    where \(e(u)\) is the mean excess function.
    For the subexponential class, \(\underset{u\to \infty}{lim}e(u)=\infty\). Therefore, \(\underset{u\to \infty}{lim}P\left( x>u+t | x>u \right)=1\) for all \(t\).
    Another derivation can be found in Lemma 1.3.5, Embrechts<sup id="cite_ref-2e"><a href="#cite_note-2">[2e]</a></sup>.
  </li>
  <li id="foot_note-6">
    <b><a href="#foot_ref-6">^</a></b>
    Here we prove that \(P\left( X_{1}+X_{2}+\cdots X_{n} > x\right) = P\left( \text{max}\left( X_{1}, X_{2}, \cdots , X_{n} \right) > x \right)\) as \(x\to \infty\) for the Pareto distribution \(\frac{\alpha}{x^{1+\alpha}}\).
    We focus on the case \(n=2\) as the general case follows by induction.
    On the right hand side we have:
    $$\displaylines{
    \begin{aligned}
    P\left( \text{max}\left( X, Y \right) > L \right) =\space & P\left( X > L \right) + P\left( Y > L \right) - P\left( X > L \wedge Y > L \right) \\
    =\space & \int_{L}^{\infty}\frac{\alpha}{x^{1+\alpha}}dx + \int_{L}^{\infty}\frac{\alpha}{y^{1+\alpha}}dy - \int_{L}^{\infty}\int_{L}^{\infty}\frac{\alpha}{x^{1+\alpha}}\frac{\alpha}{y^{1+\alpha}}dxdy \\
    =\space & \frac{1}{L^{\alpha}} + \frac{1}{L^{\alpha}} - \frac{1}{L^{2\alpha}} \\
    =\space & 2\cdot \frac{1}{L^{\alpha}}
    \end{aligned}
    }$$
    For the left hand side, we consult the below diagram:
    <div style="text-align: center;"><img src="subexponential.svg"></div>
    $$\displaylines{
    \begin{aligned}
    P\left( X+Y>L \right) =\space & 2\cdot \text{area}_{A} + \text{area}_{B} \\
    =\space & 2\cdot \int_{1}^{\frac{L}{2}}\int_{L}^{\infty}\frac{\alpha}{\left( z-y \right)^{1+\alpha}}\frac{\alpha}{y^{1+\alpha}}dzdy+\frac{2^{2\alpha}}{L^{2\alpha}} \space,\space \text{where}\space z=x+y \\
    =\space & 2\cdot \int_{1}^{\frac{L}{2}}\frac{1}{\left( L-y \right)^{\alpha}}\frac{\alpha}{y^{1+\alpha}}dy \\
    =\space & 2\left[ \frac{1}{\left( L-y \right)^{\alpha}}\left( -\frac{1}{y^{\alpha}} \right) \bigg\rvert_{1}^{\frac{L}{2}} - \int_{1}^{\frac{L}{2}}\frac{\alpha}{\left( L-y \right)^{1+\alpha}}\left( -\frac{1}{y^{\alpha}} \right)dy \right] \text{, integration by parts} \\
    =\space & 2\left[\frac{1}{\left( L-1 \right)^{\alpha}} - \frac{2^{2\alpha}}{L^{2\alpha}} + \int_{1}^{\frac{L}{2}}\frac{\alpha}{\left( L-y \right)^{1+\alpha}}\frac{1}{y^{\alpha}}dy \right] \\
    <\space & 2\left( \frac{1}{\left( L-1 \right)^{\alpha}} - \frac{2^{2\alpha}}{L^{2\alpha}} \right) \space,\space \text{since the last term is a positive number} \\
    =\space & 2\cdot \frac{1}{L^{\alpha}}
    \end{aligned}
    }$$
    Since \(P\left( \text{max}\left( X, Y \right) > L \right) < P\left( X+Y>L \right)\) and \(P\left( \text{max}\left( X, Y \right) > L \right)=\frac{2}{L^{\alpha}}\), we get \(\frac{2}{L^{\alpha}} < P\left( X+Y>L \right) < \frac{2}{L^{\alpha}}\), which completes our proof.
  </li>
  <li id="foot_note-7">
    <b><a href="#foot_ref-7">^</a></b>
    For a derivation of the mean excess function of the Pareto distribution, see Eliazar<sup id="cite_ref-4"><a href="#cite_note-4">[4]</a></sup>.
    For a list of \(e(u)\) for some standard distributions, see Table 3.4.7 Embrechts<sup id="cite_ref-2f"><a href="#cite_note-2">[2f]</a></sup>.
  </li>
</ol>

<h2>Reference</h2>
<ol style="text-align: left;">
  <li id="cite_note-1">
    ^ <b><a href="#cite_ref-1a">a</a></b>
    <b><a href="#cite_ref-1b">b</a></b>
    <b><a href="#cite_ref-1c">c</a></b>
    <b><a href="#cite_ref-1d">d</a></b>
    <b><a href="#cite_ref-1e">e</a></b>
    <b><a href="#cite_ref-1f">f</a></b>
    <b><a href="#cite_ref-1g">g</a></b>
    <b><a href="#cite_ref-1h">h</a></b>
    Nassim Nicholas Taleb, Statistical Consequences of Fat Tails: Real World Preasymptotics, Epistemology, and Applications, <a href="https://arxiv.org/abs/2001.10488">arXiv:2001.10488</a>
  </li>
  <li id="cite_note-2">
    ^ <b><a href="#cite_ref-2a">a</a></b>
    <b><a href="#cite_ref-2b">b</a></b>
    <b><a href="#cite_ref-2c">c</a></b>
    <b><a href="#cite_ref-2d">d</a></b>
    <b><a href="#cite_ref-2e">e</a></b>
    <b><a href="#cite_ref-2f">f</a></b>
    Modelling Extremal Events: for Insurance and Finance, Paul Embrechts, Claudia Klüppelberg, Thomas Mikosch, <a href="https://link.springer.com/book/10.1007/978-3-642-33483-2">Springer</a>
  </li>
  <li id="cite_note-3">
    <b><a href="#cite_ref-3">^</a></b>
    Are your data really Pareto distributed?, Pasquale Cirillo, <a href="https://arxiv.org/abs/1306.0100">arXiv:1306.0100</a>
  </li>
  <li id="cite_note-4">
    <b><a href="#cite_ref-4">^</a></b>
    Lindy's law, Iddo Eliazar, Physica A: Statistical Mechanics and its Applications
  </li>
</ol>

    </div>

    <script>
function onWindowResizeContainer() {
  const container = document.querySelector("#container");
  if (document.body.clientWidth/document.body.clientHeight > 1024/768) {
    container.style.width = "70%";
  } else {
    container.style.width = "100%";
  }
}

function main() {
  onWindowResizeContainer();
}
main();
    </script>

  </body>
</html>
</ol>

    </div>

    <script>
function onWindowResizeContainer() {
  const container = document.querySelector("#container");
  if (document.body.clientWidth/document.body.clientHeight > 1024/768) {
    container.style.width = "70%";
  } else {
    container.style.width = "100%";
  }
}

function main() {
  onWindowResizeContainer();
}
main();
    </script>

  </body>
</html>
